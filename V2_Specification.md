# V2 Specification

This file contains detailed specifications for FastMediaSorter v2, corresponding to the plan items in Version2_todo.md.

## Phase 1: Discovery and Specification

### 1.1. Define Core Concept & Goals

#### TERMS:

Иконка файла - краткая репрезентация в виде изображения. Маленькая в списке или большая в таблице при изображение некоторого числа файлов рядом друг с другом.

Типы медиафайлов - изображение, аудио, видео, анимация.

Изображение (картинка) - статическое изображение из пула распространённых форматов графических файлов (JPEG, PNG). Краткая репрезентация (иконка файла) - уменьшенный вариант с сохранением пропорций. Информация о файле: расположение, имя, расширение, размер, дата создания, размеры.

Анимация - файл GIF. Краткая репрезентация (иконка файла) - уменьшенный первый кадр. Информация о файле: расположение, имя, размер, дата создания, число кадров, размеры.

Аудиофайл - аудио из пула распространённых форматов аудио (MP3, WAV). Краткая репрезентация (иконка файла) - картинка отображающая расширение файла. Информация о файле: расположение, имя, расширение, размер, дата создания, длительность, битрейт.

Видеофайл - видео из пула распространённых форматов видео (MP4, WEBM, MOV, MKV). Может иметь аудиодорожку или нет. Краткая репрезентация (иконка файла) - уменьшенный первый кадр с сохранением пропорций. Информация о файле: расположение, имя, расширение, размер, дата создания, длительность, видеокодек, разрешение.

Медиа файлы (медиа) - все файлы из вышеперечисленных групп, которые поддерживает программа.

Папка (ресурс) - существующая [локальная папка андроид] ИЛИ [сетевая папка во внутренней локальной сети устройства] ИЛИ [папка на виртуальном диске пользователя в облаке (Google Drive, OneDrive и т.п.)] ИЛИ [SFTP Folder], которая потенциально может содержать медиафайлы. Эту папку (ресурс) пользователь зарегистрировал в программе вручную или программа нашла/добавила при сканировании. О каждой зарегистрированной в программе папке (ресурсе) мы должны хранить:
1. тип (локальная, сетевая, облачная, другая)
2. адрес (по разному для типов файлов)
3. информацию авторизации (пользователь, пароль)
4. короткое название (имя ресурса) (для отображения в списках и на кнопках сортировки)
5. типы медифайлов, с которыми прорамма будет работать внутри (несколько boolean значений)
6. имя последнего проигранного медиафайла. Для возобновления просмотра с того же места при следующем открытии
7. Число медиафайлов внутри при последнем открытии или сканировании
8. Установленный интервал для слайдшоу медиафайлов папки (ресурса)
9. Флаг о том, что ресурс так же является destination.
10. Порядок в списке destinations, если ресурс так же является destination.

Отбор файлов - в программе отбор должен быть реализован за счет: 
1. расширения файла (принадлежит типу медиа). В программе могут быть отключены видео, аудио и анимация. В таком случае любое упоминание о них так же убрано из интерфейса, пока пользователь их не включит
2. по размеру (отдельно заданные лимиты для видеофайлов, аудиофайлов, анимации, изображений)
3. по дате создания

Сортировка медиафйлов - порядок представления файлов в списке или порядок при слайд-шоу:
1. По наименованию (по алфавиту)
2. Обратно по наименованию (по обратном алфавиту)
3. По логике наименования: это когда порядок Image1, Image2, Image3, .. Image10 (в случае с обычным по-алфавиту Image10 был бы сразу за Image1)
4. По размеру
5. Обратно по размеру
6. По дате создания
7. Обратно по дате создания
8. По длительности (для видео и аудио)
9. Обратно по длительности (для видео и аудио)
10. Случайно (перемешенный порядок)

Destinations (получатели) - список папок (реурсов) до 10 папок, выбранных из числа тех, которые зарегистрированы в программе, которые доступны пользователю и программе для записи. Пользователь сам их выбрал из числа зарегистрированных папок ресурсов) или добавил в список получателей сразу при регистрации новой папки (ресурса). Используются в качестве получателей при операциях копирования и перемещения медиафайлов.

Проигрыватель (проигрывание)- демонстрация медиафайлов файлов в текущей выбранной папке (ресурсе) в их естественном виде (просмотр, прослушивание).

Слайд-шоу - проигрывание медиафайлов с переходом к следующему файлу по расписанию. Например, раз в 10 секунд. Опционально условие с расписанием может быть дополнено длительностью для видео и аудио медиафайлов. То есть будет такая опция, при которой файл проигрывается до его конца его длительности перед переходом к следующему файлу.

Сортировка - список операций которые пользователь может применить к одному файлу (копирование, перемещение, удаление, переименование) или к выбранным файлам из списка (копирование, перемещение, удаление). Для копирования и перемещения нужно предложить все допустимые Destinations.

Отмена - сложно организованная операция отмены последней операции. Наличие этой команды в интерфейсе - опция в настройках. Зависит от предыдущей операции. Переход к следующему файлу или смена папки или выход из активити - это тоже операции.
1. Если последняя операция копирование, - это значит попытаться удалить копию на получателе.
2. Если последняя операция перенос - попытаться перенести файл обратно. 
3. При операции удаления не производить физическое удаление файла сразу. Ждать следующей команды. Если следующая команда не "Отмена", тогда удалять файл. Если следущая команда "Отмена", то "забыть" о команде "Удалить", которая по-видимому была ошибочна.
4. Для переименования - попытаться вернуть оригинальное имя. опять же, если следующая команда после переименования была не "Отмена", то можно забыть оригинальное имя последнего переименованного файла.

Область отображения медиафайлов - область экрана в котором проигрывается текущий медиафайл. Это может быть полный экран или часть экрана, окруженная контролами управления (кнопками).

Поворот - статические изображения во время отображения можно повернуть на 90 градусов по горизонтали. Все медиафайлы, в том числе повёрнутые изображения должны быть максимально растянуты в области отображения. Но важно всегда сохранять оригинальные пропорции файла.

"Назад" - типичная для андроид кнопка перехода назад к предыдущему активити.

Всплывающее окно -элемент мгновенного сообщение, которое видимо несколько секунд (в зависимости от длины текста)

Диалог - появляющееся окно с информацией и кнопками, которое ждёт решения пользователя. Это может быть вопрос с вариантами Да/Нет/Отмена. Информация может быть короткой или длинной (доступной для копирования). Могут быть реализованы оригинальные кнопки (например "скопировать текст диалога в буфер обмена).


#### the primary goals for v2.:
Основной концепт новой версии программы - программа проигрыватель медиа файлов с возожностью сортировки. Для видео, аудиофайлов, файлов анимации и статических изображений (в чтом числе режим слайдшоу).

Работа с программой должна быть интуитивно понятна и проста. Программа должна предугадывать и подсказывать пользователю каждый шаг. Как минимум, при первых стартах.

В новой версии программы нет отдельных окон для режимов сортировки и слайд-шоу. В одном окне пользователь может просматривать файлы с различными условиями отбора и сортировки со сменой (листанием к следующему/предыдущему файлу) в автоматическом режиме по расписанию или вручную. И тут же принимать решение по их сортировке (копирование, перемещение, удаление, переименование), если это доступно. 

Список медиа папок (ресурсов) общий (локальные и сетевые объеденены). 

Перечень "получателей" для копирования или перемещения так же общий и так же ограничен 10 элементами, как в версии 1.

Так же важное нововведение в версии 2- работа со списком медиа файлов. Список имеет два вида - в виде иконок медиафайлов расположенных таблиицей с динамическим числом элементов (зависит от настроек и оригинального размера экрана устройства). И второй вариант - список по файлу на строку с очень уменьшеным изображением, но с детальной информации о файле в строке описания. Видео и анимация представлены первым кадром. аудио файлы - иконкой по имени расширения файла. Пользователь может несколько медиафайлов из списка выбирать для задач сортировки.
При работе со списком полльователь может производить отбор и сортировку в нём по параметрам файлов - имя, расширение, размер, дата создания, длительность видео.

Программа должна поддерживать сразу темную и светлую цветовые схемы устройства.

Программа должна поддерживать опционально операцию "отмены".

Хотелось бы подавить необходимость вызывать диалог андроид при удалении или перемещении файлов в локальных папках устройства. Если пользователь уже разрешил работать с локальными папками. Вероятно для этого нужно запросить какие-то дополнительные разрешения при первом добавлении этих папок?

Несмотря на работу областей нажатия (управления изображениями) (слева, справа, по-углам), хотелось бы так же предусмотреть инструмент зума для статических изображений и видео файлов обратному по щипку.


#### problems the new UI/UX will solve compared to v1
В первой версии пользователь путался между папками в сети и локальными, ему необходимо было между ними переходить, хотя по логике у него одни и те же задачи над ними. Отдельные кнопки "сортировка" и "слайд-шоу" тоже несколько смущают. Нет возможности просматривать и сортировать файлы списком. Мало возможностей по сортировке и отбора файла для задач. В программе первой версии много ошибок или логических нестыковок при переходе между активити.


#### which features to keep, discard, or redesign.
Программа должна сохранить и улучшить систему сбора всевозможных ошибок и сбора данных для отладки. В программе должны быть комбинированы два подхода - полное логирование для debug-версии, логирование критических ошибок в release версии. Нужно сохранить возможность получить логи текущей сессии и логи "последние 3 сессии, но не больше 512 строк", как это реализовано в версии 1. При добавлении папки нужно иметь возможность "протестировать соединение и получить текст о статусе такого соединения с папкой и короткой информации о папке (ресурсе) (уровень доступа, наличие медиафайлов по типам).

Программа должна поддерживать три языка: английский, русский, украинский с установкой языка системы при первом запуске. Если язык систем другой - то английский. Но пользователь можнет выбрать язык в настройках.

Неплохое решение по управлению слайдшоу за счет "областей нажатия" слева, справа и по углам медиафайла. Когда пользователь видит изображение на полный экран или в области отображения и управляет навигацией (следующий/предыущий) и ориентацией изображения.

Нормально реализованы операции по копированию/перемещению медиафайлов - программно сгенерированы кнопки большие или маленькие, названные и покрашены в зависимости от доступных папок "получателей". Хочется по-прежнему максимально экономить пространство экрана, оставляя ее для медиафайлов или списков медиафайлов.

Неплохо иметь Welcome screen. Возможно 7 страниц (в версии 1) это слишком много. Уместить всё нужное наверное можно в 3-5 страниц. Но важно рассказать об основных возможностях программы и первых шагах её использования.

Хочу сохранить механизм "прехэширование" следующего медиафайла для режима слайдшоу (проигрывателя)

Нужно будет оставить возможность сканирования локальных папок андроид с медиафайлами для добавление в список папок с демонстрацией количества медиафайлов. Если папка уже была зарегистрирована, а теперь количество их ноль, то это не значит, что папку нужно удалять из списка зарегистрированных в программе или из списка "получателей". 

Так же хорошо сканировать открытые папки по IP устройства - с определением права на запись, исключая системны шарды.

Exoplayer хороший выбор. Нужно обрабатывать его ошибки в том числе при работе с медиафайлами в нестабильной сети. А может ли он проигрывать аудиофайлы?


### 1.2. UI/UX Design

#### Main Screen
Основной экран программы. 
В нём пользователю видны и доступны такие элементы (в зависимости от настроек):

1. Список зарегистрированных "папок" (ресурсов). В этом списке каждый ресурс должен быть представлен в виде строки с 
    - коротким именем ресурса, 
    - полный адрес ресурса (очень мелким шрифтом),
    - тип ресурса,
    - число медиафайлов ресурса (определенное при добавлении или при последнем открытии в Browse Screen или последнем сканировании),
    - отметка, если ресурс так же в списке destinations
    - коротко по первым букам о типах медиафайлов, которые пользователь опредлил для папки ("I"mage, "V"ideo, "A"udio, "G"if (aminations)),
    - кнопка открытия "экрана профиля ресурса" для его реакции в виде иконки "edit"
    - кнопки "вверх" и "вниз"  в виде иконок "трелочек" для перемещения позиции ресурса в списке,
    - кнопка удаления папки (ресурса) из списка в виде иконки "мусорная каорзина"

Размер списка папок (ресурсов) должен быть динамический. Сначала он будет пустой, но когда он будет не помещатся на экран с учетом прочих элементов, он должен иметь полосу прокрутки пользователем.

В списке папок (ресурсов) может быть выбран только один. После открытия Main Screen должен быть подсвечен последний выбранный ресурс. Если ресурс был удален, пусть никакой ресурс не будет выбран. Пользователю нужно его выбрать.

Кнопка удаления ресурса из списка должна вызывать диалог "Вы согласны удалить ресурс?" или (если это так) "Вы согласны удалить destination?". Если пользователь ответил "ДА", то запись об этом ресурсе удаляется.

Если пользователь коротко нажимает на строку папки (ресурса), то он просто подсвечивается и становится выбранным. Как только у нас есть выбранная папка ресурс, кнопки "Запустить проигрыватель" и "Копирование ресурса" enabled.

Если пользователь "долго нажимает на ресурс" (длинное нажатие), то он вызывает Browse Screen для этого ресурса.

Если пользователь "дважды нажимает на ресурс" (двойной клик), то он вызывает Browse Screen для этого ресурса.

Если новый ресурс в список был только что добавлен вручную, он должен быть сразу выбран. Если добавленные ресурсы это результаты работы сканировани, то они не должны быть выбраны автоматически.



2. Кнопки управления этим списком папок (ресурсов) Расположены в одну строку над списком, которая  занимает 100% ширины: 
- Кнопка "Запустить проигрыватель" в виде иконки "PLAY" двойного размера.
    Вызывает Browse Screen для выбранного ресурса.
    Если ни один ресурс не выбран в списке, то кнопка "Запустить проигрыватель" disabled. 
- кнопка "Добавление ресурса" в виде иконки "большой Плюс"
    Вызывает "экран добавления и сканирования ресурсов"
- кнопка "Копирование ресурса" в виде иконки "копирование"
    Вызывает "экран добавления и сканирования ресурсов" с учетом выбранного ресурса.
    Если ни один ресурс не выбран в списке, то кнопка "Копирование ресурса" disabled. 
- небольшой пробел между кнопками
- кнопка "фильтр и сортировка" в виде иконки "фильтр"
    Вызывает "экран фильтрации и сортировки списка папок ресурсов"
- кнопка "обновить" в виде иконки "обновить"
    Вызывает процедуру обновления (пересканирования существующих папок)
- небольшой пробел между кнопками    
- кнопка перехода к Settings Screen в виде иконки "Settings"
    Вызывает Settings Screen
- кнопка выхода из программы (её закрытия) в виде иконки "Exit Door"


#### экран добавления и сканирования ресурсов
На этом экране пользователь должен ввести детали новой записи о папке ресурсе.

Такие элементы:
1. Кнопка "Назад", для отмены добавления и возрвата на "Main Screen"

2. Выбор типа ресурса.
Для этого нужен удобный элемент интерфейса:
- опция Локальная папка (доступна для нажатия, если пользователь дал право на локальные папки, иначе просто видна disabled)
- опция Сетевая папка
- опция Облачная папка
- опция SFTP (доступна для нажатия, если пользователь дал право на связь с интернет)

3. Затем, ниже, в зависимости от типа ресурса будут различные элементы:
3.1 Для локальной папки:

3.1.1 Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все локальные папки с медиа"
    Вызывает процедуру сканирования доступных локальных папок с наличием медиафайлов. Найденные ресурсы попадают в список "ресурсы к добавлению". 
    Есть предопределеные папки андроид - Download, photos, movies, Camera. Нужно определить какие есть на этом устройстве. Если этих предопределенных папок ещё нет в списке ресурсов (например при сканировании впервые), то их нужно добавить в список "ресурсы к добавлению", даже если внутри них нет медиафайлов.
    Остальные папки устройства нужно просканировать на наличие файлов медиа и, если они есть, добавить в список "ресурсы к добавлению" с названием папки (например от Telegramm или Whatsapp). Нужно проверять, что папки, которые добавляются к списку "ресурсы к добавлению" ещё не зарегистрированы в списке папок (ресурсов).

    Во время сканирования появляется всплывающее сообщение "Сканирование локальных папок.."
    Во время сканирования нужно определятся количество медиафайлов в папке.
    Во время сканирования нужно определятся право на запись в эту папку.

3.1.2 Кнопка с иконкой "выбора папки" и надписью "добавить вручную" и текстом описания "Указать папку вручную"
    При вызове этой кнопки нужен диалог выбора локальной папки. Еслии пользователь выбрал папку в диалоге, ниже кнопки должен появиться "Список папок (ресурсов) к добавлению".
    В этот список одну за другой пользователь может добавлять кнопкой "выбора папки" разные папки.
    
    После выбора папки для ресурса определяется количество медиафайлов в папке.
    После выбора папки для ресурса определяется наличие права на запись в эту папку.

3.1.3 После работы сканирования или при удовлетворительном возврате диалога "выбор папки" (при выбранной папке) ниже должен появиться (пополниться) "Список папок (ресурсов) к добавлению".
    Список состоит из найденных при сканированию или добавленных вручную добавлению ресурсов. Он состоит из набора следующих полей: 
        - галочка "Добавить". Польззователь может снять её, если не хочет добавить этот ресурс,  по умолчанию она включена
        - короткое название из имени папки, которое пользователь может отредактировать
        - количество найденных медиафайлов внутри
        - галочка "В destinations", но только для папок, которые доступны для записи. По умолчанию она выключена. Пользователь может установить её вручную для каждой строки списка перед следующим шагом.
    
    После работы сканирования или ручного добавления папок, если список не пустой, под списком появляется кнопка "Добавить к ресурсам" с иконкой "добавление в таблицу"

    По нажатию этой кнопки в список папок (ресурсов) программы добавляются все невыключенные пользователем ресурсы из списка "к добавлению" с информацией результата сканирования и заданным здесь коротким именем. Если папка указана для destinations и перечень destinations не переполнен, то к записи о таком ресурсе добавляется флаг destination и следующая свободная по очереди позиция. Если destinations уже заполнены (до 10), то папка ресурс добавляется в ресурсы без этого флага, а для пользователя появляется всплывающее сообщение, что destinations переполнены.
    
    После чего мы возвращаемся в "Main Screen"


3.2 Для сетевой папки (в локальной сети)

3.2.1 IP машины. Поле должны быть заполнено автоматически по данным IP этого андроид устройства. Например, если IP 192.168.1.100, то мы пользователю сразу заполняем поле как "192.168.1." с курсором на в конце строки. В поле пользователь может вносить только цифры и точку. Но если он вводит запятую - распознается сразу как точка.

3.2.2 Кнопка с иконкой лупы и надписью "SCAN" и текстом описания рядом "Добавить все открытые сетевые папки с этого компьютера"



#### экран профиля ресурса


#### "экран фильтрации и сортировки списка папок ресурсов"

#### Browse Screen

#### Settings Screen

#### Welcome Screen


### 1.3. Functional Specification

Нужно подобрать удобный и простой плейер для аудиофайлов с поддержкой большого числа разных разрешений (желательно так же loseless форматы)

### 1.4. Non-Functional Specification

[Здесь нефункциональные требования: производительность, безопасность и т.д.]

### 1.5. Technology Stack Selection

[Здесь детали по выбору технологий и инструментов]

### 1.6. Risk Assessment

[Здесь анализ рисков, зависимостей и стратегии минимизации]

## Phase 2: Environment and Repository Setup

### 2.1. Repository Setup

[Детали по настройке репозитория]

### 2.2. Development Environment Setup

[Настройка среды разработки]

### 2.3. Project Structure Initialization

[Инициализация структуры проекта]

### 2.4. CI/CD Pipeline Setup

[Настройка конвейера CI/CD]

### 2.5. Development Tools Configuration

[Конфигурация инструментов разработки]

## Phase 3: Detailed Development Planning

### 3.1. Architecture Design

[Дизайн архитектуры приложения]

### 3.2. Milestone Planning

[Планирование этапов и MVP]

### 3.3. Data Model Design

[Дизайн моделей данных]

### 3.4. Documentation Planning

[Планирование документации]

## Phase 4: Implementation and Iteration

### 4.1. Core Implementation

[Детали реализации основных компонентов]

### 4.2. Reference v1 Code

[Как использовать v1 как справочник]

### 4.3. Quality Assurance During Development

[Обеспечение качества во время разработки]

## Phase 5: Testing, Release, and Maintenance

### 5.1. Quality Assurance

[Финальное тестирование и QA]

### 5.2. Release Preparation

[Подготовка к релизу]

### 5.3. Launch and Post-Launch

[Запуск и пост-релизная поддержка]

### 5.4. Long-term Maintenance Planning

[Планирование долгосрочной поддержки]